<div [formGroup]="control">

  <lib-input style="padding-bottom: 10px;">
    <mat-checkbox [formControl]="ssoEnabled">
      <ng-container i18n>Allow Single Sign-On</ng-container>
    </mat-checkbox>
    <mat-icon libHelp i18n-matTooltip
              matTooltip="Decides whether this service is allowed to participate in SSO.">
    </mat-icon>
    <mat-hint align="end"><lib-hint [difference]="ssoEnabled.difference()"></lib-hint></mat-hint>
  </lib-input>

  <div formArrayName="policies" *ngIf="ssoEnabled.value">
    <mat-accordion #accordian style="width:600px;" multi="true">
      <mat-expansion-panel *ngFor="let policy of policies.controls;let last=last;let i = index" style="width:630px;left:-35px;position:relative;"
         [expanded]="last" [formGroupName]="i">
        <mat-expansion-panel-header>
          <mat-panel-title>
            <button [matMenuTriggerFor]="panelMenu" (click)="selectedPolicy = i;" mat-icon-button style="width:auto;height:auto;line-height: 0px!important;">
              <mat-icon style="font-size: medium;">menu</mat-icon>
            </button>
            <span *ngIf="isLastUsed(policy)">Last Used</span>
            <span *ngIf="isAuthDate(policy)">Authentication Date</span>
          </mat-panel-title>
          <mat-panel-description style="flex-grow: 0; margin-right: 60px;">
            <span style="float: right">{{ (policy.get('timeValue').value || '') + ' ' + (policy.get('timeUnit').value || '') }}</span>
          </mat-panel-description>
        </mat-expansion-panel-header>
        <lib-sso-policy [control]="policy"></lib-sso-policy>
      </mat-expansion-panel>
    </mat-accordion>
    <div style="height:25px;width:600px;padding-top: 10px;">
      <button mat-mini-fab [matMenuTriggerFor]="addMenu" style="float:right;">+</button>
    </div>
  </div>
</div>
<mat-menu #panelMenu>
  <button mat-menu-item (click)="moveUp()" i18n>Move UP</button>
  <button mat-menu-item (click)="moveDown()" i18n>Move Down</button>
  <button mat-menu-item (click)="removePolicy()" i18n>Remove</button>
</mat-menu>

<mat-menu #addMenu>
  <button mat-menu-item (click)="addPolicy.emit(TYPE.LAST_USED)" i18n>Last Used</button>
  <button mat-menu-item (click)="addPolicy.emit(TYPE.AUTH_DATE)" i18n>Authentication Date</button>
</mat-menu>
